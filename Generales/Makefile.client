# Makefile para Cliente Local - ImageServer
# CE 4303 - Principios de Sistemas Operativos

# Variables bÃ¡sicas
CC = gcc
CFLAGS = -Wall -Wextra -std=c99
TARGET = client
SOURCE = client.c

# === COMPILACIÃ“N ===

# Regla principal - compila el cliente
all: $(TARGET)
	@echo "âœ… Cliente compilado exitosamente"

# Compilar el ejecutable
$(TARGET): $(SOURCE)
	$(CC) $(CFLAGS) -o $(TARGET) $(SOURCE)

# Compilar con informaciÃ³n de debug
debug: CFLAGS += -g -DDEBUG
debug: $(TARGET)
	@echo "ğŸ› Cliente compilado en modo debug"

# === CONFIGURACIÃ“N BÃSICA ===

# Crear directorio para imÃ¡genes
setup:
	@echo "ğŸ“ Configurando entorno..."
	@mkdir -p images
	@echo "âœ… Directorio 'images' creado"
	@echo "ğŸ’¡ Coloque sus imÃ¡genes de prueba en ./images/"

# === EJECUCIÃ“N ===

# Ejecutar cliente
run: $(TARGET)
	@echo "ğŸš€ Iniciando cliente..."
	@echo "ğŸ’¡ AsegÃºrese de que el servidor estÃ© ejecutÃ¡ndose"
	./$(TARGET)

# === PRUEBAS BÃSICAS ===

# Verificar si el servidor estÃ¡ corriendo
test-server:
	@echo "ğŸ” Verificando servidor en puerto 8080..."
	@timeout 3 bash -c "</dev/tcp/127.0.0.1/8080" 2>/dev/null && \
	 echo "âœ… Servidor accesible" || \
	 echo "âŒ Servidor no disponible - asegÃºrese de que estÃ© corriendo"

# Listar imÃ¡genes disponibles
list-images:
	@echo "ğŸ“¸ ImÃ¡genes disponibles:"
	@if [ -d images ]; then \
		ls -la images/ 2>/dev/null || echo "   (directorio vacÃ­o)"; \
	else \
		echo "   Directorio 'images' no existe - ejecute 'make setup'"; \
	fi

# === LIMPIEZA ===

# Limpiar archivos compilados
clean:
	@echo "ğŸ§¹ Limpiando..."
	rm -f $(TARGET) *.o
	@echo "âœ… Archivos limpiados"

# === AYUDA ===

# Mostrar comandos disponibles
help:
	@echo "ğŸ› ï¸  Makefile para Cliente Local"
	@echo "=============================="
	@echo ""
	@echo "ğŸ“‹ COMANDOS DISPONIBLES:"
	@echo "   make          - Compilar cliente"
	@echo "   make run      - Ejecutar cliente"
	@echo "   make setup    - Crear directorio de imÃ¡genes"
	@echo "   make debug    - Compilar con debug"
	@echo "   make clean    - Limpiar archivos"
	@echo ""
	@echo "ğŸ§ª PRUEBAS:"
	@echo "   make test-server  - Verificar si servidor estÃ¡ corriendo"
	@echo "   make list-images  - Ver imÃ¡genes disponibles"
	@echo ""
	@echo "ğŸ’¡ USO TÃPICO:"
	@echo "   make setup    # Solo la primera vez"
	@echo "   make          # Compilar"
	@echo "   make run      # Ejecutar"

# Reglas que no crean archivos
.PHONY: all debug setup run test-server list-images clean help